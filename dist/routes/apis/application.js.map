{"version":3,"sources":["../../../routes/apis/application.js"],"names":["Application","require","model","Component","express","router","Router","get","req","res","find","err","applications","send","json","findById","params","aid","populate","exec","then","a","catch","status","put","findByIdAndUpdate","name","body","delete","findByIdAndRemove","components","forEach","cid","Promise","reject","post","component","save","c","id","module","exports"],"mappings":";;AAAA,IAAMA,cAAcC,QAAQ,0BAAR,EAAoCC,KAAxD;AACA,IAAMC,YAAYF,QAAQ,wBAAR,EAAkCC,KAApD;;AAEA,IAAIE,UAAUH,QAAQ,SAAR,CAAd;AACA,IAAII,SAASD,QAAQE,MAAR,EAAb;;AAEAD,OAAOE,GAAP,CAAW,GAAX,EAAgB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC1BT,gBAAYU,IAAZ,CAAiB,UAACC,GAAD,EAAMC,YAAN,EAAuB;AACpC,YAAID,GAAJ,EAASF,IAAII,IAAJ,CAASF,GAAT,EAAT,KACKF,IAAIK,IAAJ,CAASF,YAAT;AACR,KAHD;AAIH,CALD;;AAOAP,OAAOE,GAAP,CAAW,OAAX,EAAoB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC9BT,gBAAYe,QAAZ,CAAqBP,IAAIQ,MAAJ,CAAWC,GAAhC,EACKC,QADL,CACc,YADd,EAEKC,IAFL,GAGKC,IAHL,CAGU;AAAA,eAAKX,IAAIK,IAAJ,CAASO,CAAT,CAAL;AAAA,KAHV,EAIKC,KAJL,CAIW;AAAA,eAAOb,IAAIc,MAAJ,CAAW,GAAX,EAAgBV,IAAhB,CAAqBF,GAArB,CAAP;AAAA,KAJX;AAKH,CAND;;AAQAN,OAAOmB,GAAP,CAAW,OAAX,EAAoB,UAAChB,GAAD,EAAMC,GAAN,EAAc;AAC9BT,gBAAYyB,iBAAZ,CAA8BjB,IAAIQ,MAAJ,CAAWC,GAAzC,EACI,EAACS,MAAMlB,IAAImB,IAAJ,CAASD,IAAhB,EADJ,EAEI,EAAC,OAAO,IAAR,EAFJ,EAGKP,IAHL,GAIKC,IAJL,CAIU;AAAA,eAAKX,IAAIK,IAAJ,CAASO,CAAT,CAAL;AAAA,KAJV,EAKKC,KALL,CAKW;AAAA,eAAOb,IAAIc,MAAJ,CAAW,GAAX,EAAgBV,IAAhB,CAAqBF,GAArB,CAAP;AAAA,KALX;AAMH,CAPD;;AASAN,OAAOuB,MAAP,CAAc,OAAd,EAAuB,UAACpB,GAAD,EAAMC,GAAN,EAAc;AACjCT,gBAAY6B,iBAAZ,CAA8BrB,IAAIQ,MAAJ,CAAWC,GAAzC,EACKG,IADL,CACU;AAAA,eAAKC,EAAES,UAAF,CAAaC,OAAb,CACP;AAAA,mBACI5B,UAAU0B,iBAAV,CAA4BG,GAA5B,EACKV,KADL,CACW;AAAA,uBAAQW,QAAQC,MAAR,CAAevB,GAAf,CAAR;AAAA,aADX,CADJ;AAAA,SADO,CAAL;AAAA,KADV,EAMKS,IANL,CAMU;AAAA,eAAMX,IAAIc,MAAJ,CAAW,GAAX,EAAgBV,IAAhB,EAAN;AAAA,KANV,EAOKS,KAPL,CAOW;AAAA,eAAOb,IAAIc,MAAJ,CAAW,GAAX,EAAgBV,IAAhB,CAAqBF,GAArB,CAAP;AAAA,KAPX;AAQH,CATD;;AAWA;AACAN,OAAOE,GAAP,CAAW,iBAAX,EAA8B,UAACC,GAAD,EAAMC,GAAN,EAAc;AACxCT,gBAAYe,QAAZ,CAAqBP,IAAIQ,MAAJ,CAAWC,GAAhC,EACKC,QADL,CACc,YADd,EAEKC,IAFL,GAGKC,IAHL,CAGU;AAAA,eAAKX,IAAIK,IAAJ,CAASO,EAAES,UAAX,CAAL;AAAA,KAHV,EAIKR,KAJL,CAIW;AAAA,eAAOb,IAAIc,MAAJ,CAAW,GAAX,EAAgBV,IAAhB,CAAqBF,GAArB,CAAP;AAAA,KAJX;AAKH,CAND;;AAQAN,OAAO8B,IAAP,CAAY,iBAAZ,EAA+B,UAAC3B,GAAD,EAAMC,GAAN,EAAc;AACzC,QAAM2B,YAAY,IAAIjC,SAAJ,CAAc,EAACuB,MAAMlB,IAAImB,IAAJ,CAASD,IAAhB,EAAd,CAAlB;AACAU,cAAUC,IAAV,GACKjB,IADL,CACU;AAAA,eAAKpB,YAAYyB,iBAAZ,CACPjB,IAAIQ,MAAJ,CAAWC,GADJ,EAEP,EAAC,SAAS,EAACa,YAAYQ,EAAEC,EAAf,EAAV,EAFO,EAGP,EAAC,OAAO,IAAR,EAHO,EAINpB,IAJM,GAKNC,IALM,CAKD;AAAA,mBAAMX,IAAIK,IAAJ,CAASwB,CAAT,CAAN;AAAA,SALC,CAAL;AAAA,KADV,EAOKhB,KAPL,CAOW;AAAA,eAAOb,IAAIc,MAAJ,CAAW,GAAX,EAAgBV,IAAhB,CAAqBF,GAArB,CAAP;AAAA,KAPX;AAQH,CAVD;;AAYAN,OAAOmB,GAAP,CAAW,sBAAX,EAAmC,UAAChB,GAAD,EAAMC,GAAN,EAAc;AAC7CN,cAAUsB,iBAAV,CAA4BjB,IAAIQ,MAAJ,CAAWgB,GAAvC,EACIxB,IAAImB,IADR,EAEI,EAAC,OAAO,IAAR,EAFJ,EAGKR,IAHL,GAIKC,IAJL,CAIU;AAAA,eAAKX,IAAIK,IAAJ,CAASwB,CAAT,CAAL;AAAA,KAJV,EAKKhB,KALL,CAKW;AAAA,eAAOb,IAAIc,MAAJ,CAAW,GAAX,EAAgBV,IAAhB,CAAqBF,GAArB,CAAP;AAAA,KALX;AAMH,CAPD;;AASAN,OAAOuB,MAAP,CAAc,sBAAd,EAAsC,UAACpB,GAAD,EAAMC,GAAN,EAAc;AAChDN,cAAU0B,iBAAV,CAA4BrB,IAAIQ,MAAJ,CAAWgB,GAAvC,EACKZ,IADL,CACU;AAAA,eAAMX,IAAIc,MAAJ,CAAW,GAAX,EAAgBV,IAAhB,EAAN;AAAA,KADV,EAEKS,KAFL,CAEW;AAAA,eAAOb,IAAIc,MAAJ,CAAW,GAAX,EAAgBV,IAAhB,CAAqBF,GAArB,CAAP;AAAA,KAFX;AAGH,CAJD;;AAMA6B,OAAOC,OAAP,GAAiBpC,MAAjB","file":"application.js","sourcesContent":["const Application = require('../../models/application').model;\nconst Component = require('../../models/component').model;\n\nvar express = require('express');\nvar router = express.Router();\n\nrouter.get('/', (req, res) => {\n    Application.find((err, applications) => {\n        if (err) res.send(err);\n        else res.json(applications)\n    });\n});\n\nrouter.get('/:aid', (req, res) => {\n    Application.findById(req.params.aid)\n        .populate('components')\n        .exec()\n        .then(a => res.json(a))\n        .catch(err => res.status(503).send(err))\n});\n\nrouter.put('/:aid', (req, res) => {\n    Application.findByIdAndUpdate(req.params.aid,\n        {name: req.body.name},\n        {'new': true})\n        .exec()\n        .then(a => res.json(a))\n        .catch(err => res.status(503).send(err));\n});\n\nrouter.delete('/:aid', (req, res) => {\n    Application.findByIdAndRemove(req.params.aid)\n        .then(a => a.components.forEach(\n            cid =>\n                Component.findByIdAndRemove(cid)\n                    .catch(err =>  Promise.reject(err))\n        ))\n        .then(() => res.status(204).send())\n        .catch(err => res.status(503).send(err));\n});\n\n// for component\nrouter.get('/:aid/component', (req, res) => {\n    Application.findById(req.params.aid)\n        .populate('components')\n        .exec()\n        .then(a => res.json(a.components))\n        .catch(err => res.status(503).send(err));\n});\n\nrouter.post('/:aid/component', (req, res) => {\n    const component = new Component({name: req.body.name});\n    component.save()\n        .then(c => Application.findByIdAndUpdate(\n            req.params.aid,\n            {'$push': {components: c.id}},\n            {'new': true})\n            .exec()\n            .then(() => res.json(c)))\n        .catch(err => res.status(503).send(err));\n});\n\nrouter.put('/:aid/component/:cid', (req, res) => {\n    Component.findByIdAndUpdate(req.params.cid,\n        req.body,\n        {'new': true})\n        .exec()\n        .then(c => res.json(c))\n        .catch(err => res.status(503).send(err));\n});\n\nrouter.delete('/:aid/component/:cid', (req, res) => {\n    Component.findByIdAndRemove(req.params.cid)\n        .then(() => res.status(204).send())\n        .catch(err => res.status(503).send(err));\n});\n\nmodule.exports = router;\n"]}